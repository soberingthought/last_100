<html>
<head>
  <title>Last 100 posts by number of comments</title>
  <style type="text/css">
    html,body{min-height:100%;margin:0}body{background:#e4f5fc;background:-moz-linear-gradient(top,#e4f5fc 0,#bfe8f9 50%,#9fd8ef 51%,#2ab0ed 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0,#e4f5fc),color-stop(50%,#bfe8f9),color-stop(51%,#9fd8ef),color-stop(100%,#2ab0ed));background:-webkit-linear-gradient(top,#e4f5fc 0,#bfe8f9 50%,#9fd8ef 51%,#2ab0ed 100%);background:-o-linear-gradient(top,#e4f5fc 0,#bfe8f9 50%,#9fd8ef 51%,#2ab0ed 100%);background:-ms-linear-gradient(top,#e4f5fc 0,#bfe8f9 50%,#9fd8ef 51%,#2ab0ed 100%);background:linear-gradient(to bottom,#e4f5fc 0,#bfe8f9 50%,#9fd8ef 51%,#2ab0ed 100%);filter:progid:DXImageTransformMicrosoft.gradient(startColorstr='#e4f5fc',endColorstr='#2ab0ed',GradientType=0)}h1,h2,h3,h4,h5{font-family:verdana,arial,helvetica,sans-serif}div.sdheader_text{display:inline-block;position:relative;height:auto;width:auto;float:left;padding-left:30px}.snoo-image{float:left}.sdheader{position:relative;margin:0;height:60px;border-top-left-radius:25px;-moz-border-top-left-radius:25px;border-top-right-radius:25px;-moz-border-top-right-radius:25px;border-bottom:2px solid;margin:0;background:#fceabb;background:-moz-linear-gradient(top,#fceabb 0,#fccd4d 50%,#f8b500 51%,#fbdf93 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0,#fceabb),color-stop(50%,#fccd4d),color-stop(51%,#f8b500),color-stop(100%,#fbdf93));background:-webkit-linear-gradient(top,#fceabb 0,#fccd4d 50%,#f8b500 51%,#fbdf93 100%);background:-o-linear-gradient(top,#fceabb 0,#fccd4d 50%,#f8b500 51%,#fbdf93 100%);background:-ms-linear-gradient(top,#fceabb 0,#fccd4d 50%,#f8b500 51%,#fbdf93 100%);background:linear-gradient(to bottom,#fceabb 0,#fccd4d 50%,#f8b500 51%,#fbdf93 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fceabb',endColorstr='#fbdf93',GradientType=0)}.wrapper{position:relative;margin-top:none;margin-right:10%;margin-left:10%;padding:0;border:2px solid black;border-radius:25px;-moz-border-radius:25px;box-shadow:10px 10px 5px #888;width:auto;height:auto;background-color:#e4f5fc}img.snoo{border-top-left-radius:25px;-moz-border-top-left-radius:25px;height:60px}div.main-text{padding-left:18px;padding-right:18px;font-family:arial,verdana,helvetica,sans-serif}.results_table{border:1px solid black}.results_table th{text-align:center;padding:5px;background-color:#e0e0e0}.results_table td{text-align:center;padding:5px}.highlight{background-color:#fceabb;font-weight:bold}.legend{text-align:left !important;border-top:1px dotted black;font-size:x-small}.naked{text-decoration:none;color:inherit}.naked:hover{background-color:#e3e4fa}.bare{text-decoration:none}.bare:hover{font-weight:bold}.legal{font-size:small;width:100%;text-align:center;vertical-align:middle}table.tablesorter thead tr .header{background-image:url(/images/tablesorter_ascdesc.gif);background-repeat:no-repeat;background-position:center right;cursor:pointer}table.tablesorter tbody tr.odd td{background-color:#f0f0f6}table.tablesorter thead tr .headerSortUp{background-image:url(/images/tablesorter_asc.gif)}table.tablesorter thead tr .headerSortDown{background-image:url(/images/tablesorter_desc.gif)}.datagrid table{border-collapse:collapse;text-align:left;width:100%}.datagrid{font:normal 12px/150% Arial,Helvetica,sans-serif;background:#fff;overflow:hidden;border:1px solid #069;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}.datagrid table td,.datagrid table th{padding:3px 10px}.datagrid table thead th{background:-webkit-gradient(linear,left top,left bottom,color-stop(0.05,#069),color-stop(1,#00557f));background:-moz-linear-gradient(center top,#069 5%,#00557f 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#006699',endColorstr='#00557F');background-color:#069;color:#fff;font-size:15px;font-weight:bold;border-left:1px solid #0070a8}.datagrid table thead th:first-child{border:0}.datagrid table tbody td{color:#00496b;border-left:1px solid #e1eef4;font-size:12px;font-weight:normal}.datagrid table tbody .alt td{background:#e1eef4;color:#00496b}.datagrid table tbody td:first-child{border-left:0}.datagrid table tbody tr:last-child td{border-bottom:0}.datagrid table tfoot td div{border-top:1px solid #069;background:#e1eef4}.datagrid table tfoot td{padding:0;font-size:12px}.datagrid table tfoot td div{padding:2px}.datagrid table tfoot td ul{margin:0;padding:0;list-style:none;text-align:right}.datagrid table tfoot li{display:inline}.datagrid table tfoot li a{text-decoration:none;display:inline-block;padding:2px 8px;margin:1px;color:#fff;border:1px solid #069;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;background:-webkit-gradient(linear,left top,left bottom,color-stop(0.05,#069),color-stop(1,#00557f));background:-moz-linear-gradient(center top,#069 5%,#00557f 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#006699',endColorstr='#00557F');background-color:#069}.datagrid table tfoot ul.active,.datagrid table tfoot ul a:hover{text-decoration:none;border-color:#069;color:#fff;background:0;background-color:#00557f}div.dhtmlx_window_active,div.dhx_modal_cover_dv{position:fixed !important}.datagrid table tbody tr:hover{background-color:#ffd}<? $sub = 'stopdrinking';if(isset($_GET['sub'])){$sub = $_GET['sub']}?>.main-text ul{list-style:none;text-indent:-1.5em}.selftext{display:none;position:absolute;border:1px solid orange;background-color:#eee;z-index:10;text-indent:0}.preview>.selftext{display:none}.preview:hover>.selftext{display:block}div.c4{text-align:center}img.c3{border-style:none}a.c2{text-decoration:none;color:black}p.c1{font-style:italic}
  </style>
</head>

<body>

  <p>&nbsp;</p>

  <div class="c4">
    <small><a href="index.php.txt">source code for this page</a></small>

    <p xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#"><small><a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" class="c3" alt="CC0"></a><br>
    To the extent possible under law, <a rel="dct:publisher" href="http://sd.bot.nu/by_num_comments/"><span property="dct:title">/r/stopdrinking</span></a> has waived all copyright and related or neighboring rights to the code that generates this page. This work is published from: <span property="vcard:Country" datatype="dct:ISO3166" content="US" about="http://sd.bot.nu/by_num_comments/">United States</span>.</small></p>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.7.2/URI.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    var subreddit = "stopdrinking";
    $( document ).ready(function() {
      buildSkeleton();
      getem();
    });

    function getem(){
      var url = "https://www.reddit.com/r/stopdrinking/new/.json?limit=100";
      $.getJSON(url, function(data){
        var arr = data.data.children;
        arr = arr.reverse();
        $.each(arr, function(i,item){
          addItem(item);
        });
      });
    }

    function wrapper() {
      var subredditNewURL = URI.expand("http://www.reddit.com/r/{subreddit}/new", {subreddit: subreddit});

      var snooImage = newTag({
        src: "https://b.thumbs.redditmedia.com/fe8YvQZwi0UpLCPsjcIlLAPyHLpMWVmawN3u_4nAmFk.png",
        alt:" Snoo saying 'Joo got thees, meng!'",
        title: "Joo got thees, meng!",
        class: "snoo"
      }, "img");

      var newLink = newTag({ href: subredditNewURL }, "a").append(snooImage);
      var sdHeader = newTag({ class: "sdheader" }).append(newTag({class: "snoo-image"}).append(newLink));
      var sdHeaderText = newTag({class: "sdheader_text"}).append(newTag({class: "c1"}, "p").text("Let's make sure no one falls through the cracks"));


      return newTag({class: "wrapper"}).append(sdHeader.append(sdHeaderText));
    }

    function mainText() {
      var subredditURL = URI.expand("http://www.reddit.com/r/{subreddit}", {subreddit: subreddit});
      var link = newTag({ class: "c2", href: subredditURL }, "a").text("/r/" + subreddit);
      var h2 = newTag({}, "h2").append("Recent ").append(link).append(" posts that may need attention");
      var results = newTag({ id: "results" })
      var i;
      for (i = 0 ; i <= 5; i++) {
        var h3 = newTag({}, "h3").text(i + " comments")
        var list = newTag({ id: "comments"+i }, "ul");
        results.append(h3).append(list);
      }

      return newTag({class: "main-text"}).append(h2).append(newTag({}, "hr")).append(results);
    }

    function buildSkeleton() {
      $("body")
        .prepend(wrapper().append(mainText()))
    }

    function newTag(attrs, tag="div") {
      return $('<' + tag + '/>').attr(attrs)
    }

    function addItem(item){
      hours_old =  Math.round(((+new Date()/1000) - item.data.created_utc) / 3600);
      mytext = item.data.selftext;
      var html = '<li><span class="preview"> &#x1f441 <div class="selftext">'+mytext+'<\/div><\/span>['+hours_old+' hours ago, by '+item.data.author+'] <a href="http://www.reddit.com'+item.data.permalink+'">'+item.data.title+'<\/a><\/li>';
      if (item.data.num_comments <=5){
        $("#comments" + item.data.num_comments).append(html);
      }
    }
  </script>
</body>
</html>
